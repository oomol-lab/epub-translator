# Release v0.1.7

This release improves MathML handling and fixes critical bugs related to inline mathematical formulas and user prompt templates.

## âœ¨ New Features

### LaTeX Rendering for LLMs (#121)

Replaced XSLT-based MathML to LaTeX conversion with the `mathml2latex` library, providing more reliable mathematical formula rendering for Large Language Models during translation. This improves the quality of translations for documents containing mathematical expressions.

**Technical Changes:**
- Removed legacy XSLT stylesheets from `epub_translator/data/mmltex/`
- Added `mathml2latex` (>=0.2.12, <0.3.0) as a new dependency
- Implemented new `_render_latex` helper function using `mathml2latex` and BeautifulSoup

Related PR: https://github.com/oomol-lab/epub-translator/pull/121

## ðŸ› Bug Fixes

### Fixed Mixed Text with Inline Math Formulas (#120)

Fixed issue [#119](https://github.com/oomol-lab/epub-translator/issues/119) where paragraphs containing inline MathML formulas (e.g., `<math display="inline">`) would generate mixed original and translated text instead of properly separated bilingual paragraphs in `APPEND_BLOCK` mode.

**Technical Improvements:**
- Introduced `find_block_depth()` function (now part of public API in `epub_translator.segment`)
- Replaced string-based `is_inline_tag` with element-based `is_inline_element` for better detection
- Enhanced display attribute checking for MathML elements
- Improved inline element hierarchy evaluation

Related PR: https://github.com/oomol-lab/epub-translator/pull/120
Related Issue: https://github.com/oomol-lab/epub-translator/issues/119

### Fixed Missing User Prompt (#118)

Fixed issue [#117](https://github.com/oomol-lab/epub-translator/issues/117) where the `user_prompt` parameter was not being included in the translation template. The prompt is now properly wrapped in `<rules>` tags and passed to the LLM.

**Template Change:**
```jinja
{% if user_prompt -%}
<rules>
{{ user_prompt }}
</rules>
{% endif -%}
```

Related PR: https://github.com/oomol-lab/epub-translator/pull/118
Related Issue: https://github.com/oomol-lab/epub-translator/issues/117

## ðŸ“¦ Installation

```bash
pip install epub-translator==0.1.7
```

Or upgrade:

```bash
pip install --upgrade epub-translator
```

## ðŸ”„ Migration from v0.1.6

This release is fully backward compatible with v0.1.6. No code changes are required.

**New Dependencies:**
- `mathml2latex` (>=0.2.12, <0.3.0) - automatically installed with pip

**Bug Fixes:**
- If you experienced mixed text issues with inline math formulas in APPEND_BLOCK mode, this release fixes that automatically
- If your custom prompts weren't working, they will now be properly included in translations

## ðŸ™ Contributors

Special thanks to all contributors who reported issues and helped improve this release!
