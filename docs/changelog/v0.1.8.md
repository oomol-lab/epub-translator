# Release v0.1.8

This release adds token usage monitoring capabilities and fixes MathML inline element detection issues.

## ‚ú® New Features

### Token Usage Statistics (#125)

Implemented comprehensive token usage tracking to help monitor API costs and resource consumption during translation. The `LLM` class now provides real-time statistics about token usage.

**Key Features:**
- Track total tokens, input tokens, cached input tokens, and output tokens
- Monitor token consumption in real-time during translation
- Support for dual-LLM scenarios with independent statistics for translation and filling operations
- Easy integration with progress callbacks for live cost estimation

**New LLM Properties:**
- `total_tokens` - Total number of tokens used (input + output)
- `input_tokens` - Number of prompt/input tokens
- `input_cache_tokens` - Number of cached input tokens (when using prompt caching)
- `output_tokens` - Number of generated/completion tokens

**Example Usage:**
```python
from epub_translator import LLM, translate, language, SubmitKind

llm = LLM(
    key="your-api-key",
    url="https://api.openai.com/v1",
    model="gpt-4",
    token_encoding="o200k_base",
)

translate(
    source_path="source.epub",
    target_path="translated.epub",
    target_language=language.ENGLISH,
    submit=SubmitKind.APPEND_BLOCK,
    llm=llm,
)

# Access token statistics after translation
print(f"Total tokens: {llm.total_tokens}")
print(f"Input tokens: {llm.input_tokens}")
print(f"Output tokens: {llm.output_tokens}")
```

Related PR: https://github.com/oomol-lab/epub-translator/pull/125
Related Issue: https://github.com/oomol-lab/epub-translator/issues/33

## üêõ Bug Fixes

### Improved Inline Element Detection (#124)

Enhanced MathML inline element detection by using element-based `is_inline_element()` function instead of string-based tag comparison. Also added whitespace normalization for mathematical expressions to ensure consistent LaTeX rendering.

**Technical Changes:**
- Replaced string-based inline tag detection with element-based `is_inline_element()` check
- Added `normalize_whitespace()` to clean up LaTeX expression formatting
- Improved consistency in detecting inline vs block mathematical elements

Related PR: https://github.com/oomol-lab/epub-translator/pull/124

### Fixed MathML Display Attribute Handling (#123)

Fixed issue where `<math>` elements without an explicit `display="block"` attribute were not being correctly identified as inline elements. The code now properly uses the `DISPLAY_ATTRIBUTE` constant for consistent attribute checking.

**Technical Changes:**
- Replaced hardcoded `"display"` strings with `DISPLAY_ATTRIBUTE` constant
- Improved consistency in MathML display attribute handling across the codebase
- Better alignment with MathML specification for inline element detection

Related PR: https://github.com/oomol-lab/epub-translator/pull/123

## üì¶ Installation

```bash
pip install epub-translator==0.1.8
```

Or upgrade:

```bash
pip install --upgrade epub-translator
```

## üîÑ Migration from v0.1.7

This release is fully backward compatible with v0.1.7. No code changes are required.

**New Capabilities:**
- Token usage statistics are now available on `LLM` instances - access them anytime after translation
- If you experienced issues with inline MathML elements being incorrectly formatted, this release fixes that automatically

**No Breaking Changes:**
- All existing code continues to work without modifications
- Token statistics are optional - ignore them if you don't need cost monitoring

## üôè Contributors

Special thanks to all contributors who reported issues and helped improve this release!
