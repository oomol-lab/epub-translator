# Release v0.1.2

This release brings significant architectural improvements to the translation engine, including a complete XML processing overhaul, enhanced error handling, and metadata translation support. The new architecture provides better translation quality, improved robustness, and more control over the translation process.

## ‚ú® Major Features

### Complete Table of Contents and Metadata Translation (#90)
- **Translate EPUB metadata and table of contents**
- Added comprehensive metadata translation support including title, creator, description, and other OPF metadata fields
- Table of contents entries are now fully translated alongside chapter content
- Unified translation workflow for content, TOC, and metadata
- Related PR: https://github.com/oomol-lab/epub-translator/pull/90

### Dual-LLM Architecture (#88, #89)
- **Separate LLM instances for translation and XML filling operations**
- Independent temperature and sampling parameters for each task:
  - Translation uses higher temperature (0.8) for more creative, natural output
  - XML filling uses lower temperature (0.3) for deterministic, structure-preserving results
- Improved translation quality through task-specific optimization
- Enhanced prompt templates with better error guidance
- Related PRs:
  - https://github.com/oomol-lab/epub-translator/pull/88
  - https://github.com/oomol-lab/epub-translator/pull/89

### Advanced Error Callback System (#93, #94)
- **New callback system for monitoring and handling translation errors**
- Added `on_fill_failed` callback to expose XML filling failures
- Exported `FillFailedEvent` for error inspection and custom handling
- Includes retry count information and maximum retry warnings
- New XML interrupt system with multiple callback hooks:
  - `interrupt_source_text_segments`
  - `interrupt_translated_text_segments`
  - `interrupt_block_element`
- Enables custom error recovery and debugging workflows
- Related PRs:
  - https://github.com/oomol-lab/epub-translator/pull/93
  - https://github.com/oomol-lab/epub-translator/pull/94

### Enhanced API (#89, #90)
- **More flexible LLM configuration**
- New parameters in `translate()` function:
  - `target_language`: Explicit target language specification
  - `user_prompt`: Custom translation instructions
  - `llm`, `translation_llm`, `fill_llm`: Flexible LLM configuration with fallback
  - `on_progress`: Progress tracking callback
- Updated `LLM` constructor parameters:
  - `key`: API key (renamed from previous parameter names)
  - `cache_path`: Cache directory path
  - `log_dir_path`: Log directory path
- Path parameters now accept `PathLike | str` for improved flexibility
- Related PRs:
  - https://github.com/oomol-lab/epub-translator/pull/89
  - https://github.com/oomol-lab/epub-translator/pull/90

## üèóÔ∏è Architecture Improvements

### Complete XML Processing Overhaul (#80-#87)
The translation engine has been completely rewritten with a new architecture:

- **Inline and Block Segmentation** (#80, #81): New segment-based XML processing with automatic ID tracking, validation, and comprehensive error reporting
- **Hill Climbing Algorithm** (#82, #84): Intelligent iterative XML refinement with error-weighted optimization
- **Enhanced Validation** (#83): Hierarchical error grouping, scoring, and user-facing reporting with context-aware error messages
- **Stream-Based Mapping** (#85, #86): Token-aware XML element streaming with intelligent truncation and document structure preservation
- **Code Cleanup** (#87): Removed legacy components and simplified public API

The new architecture provides:
- Better handling of complex XML structures
- More accurate preservation of document formatting
- Improved error recovery through iterative refinement
- Reduced token usage through optimized ID assignment

Related PRs:
- https://github.com/oomol-lab/epub-translator/pull/80
- https://github.com/oomol-lab/epub-translator/pull/81
- https://github.com/oomol-lab/epub-translator/pull/82
- https://github.com/oomol-lab/epub-translator/pull/83
- https://github.com/oomol-lab/epub-translator/pull/84
- https://github.com/oomol-lab/epub-translator/pull/85
- https://github.com/oomol-lab/epub-translator/pull/86
- https://github.com/oomol-lab/epub-translator/pull/87

## üêõ Bug Fixes

### Windows Path Separator Issue (#79)
- **Fixed ZIP file path handling on Windows**
- Resolved issue where Windows backslash path separators caused ZIP file read failures
- Changed path handling to use `.as_posix()` for cross-platform compatibility
- Fixes reading EPUB files on Windows systems
- Related issue: https://github.com/oomol-lab/epub-translator/issues/69
- Related PR: https://github.com/oomol-lab/epub-translator/pull/79

### Lost Paragraphs (#91)
- **Fixed bug causing paragraph loss during translation**
- Corrected control flow in stream mapper to properly handle element transitions
- Ensured all text segments are captured at element boundaries
- Related PR: https://github.com/oomol-lab/epub-translator/pull/91

### Inline Segment Processing (#92)
- **Fixed inline segment collection and ordering**
- Replaced recursive approach with stack-based aggregation for better control
- Fixed head appending from next inline segment to proper tail position
- Added `depth` property to `TextSegment` class
- Migrated tests from unittest to pytest framework
- Related PR: https://github.com/oomol-lab/epub-translator/pull/92

## üì¶ Installation

```bash
pip install epub-translator==0.1.2
```

Or upgrade from a previous version:

```bash
pip install --upgrade epub-translator
```

## ‚ö†Ô∏è Breaking Changes

While we've tried to maintain backward compatibility, some API changes may affect advanced users:

1. **LLM Constructor**: Parameter names have been updated (e.g., API key parameter is now `key`)
2. **Internal APIs**: Many internal classes and functions have been refactored or removed
3. **Placeholder System**: Removed in favor of the new XML interrupter callback system

For most users using the high-level `translate()` function, the changes should be transparent or require only minor adjustments.

## üôè Acknowledgments

This release represents months of architectural refinement and testing. Special thanks to everyone who reported issues, provided feedback, and contributed to making this release possible!
