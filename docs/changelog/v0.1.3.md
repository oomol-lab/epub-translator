# Release v0.1.3

This release focuses on improving EPUB compatibility, optimizing the translation pipeline, and enhancing cache reliability. Key improvements include better handling of non-standard EPUB formats, streamlined processing logic, and a more robust caching mechanism.

## üêõ Bug Fixes

### EPUB Format Compatibility (#96)
- **Enhanced media type recognition in spine processing**
- `search_spine_paths` now returns `(Path, media_type)` tuples for better MIME type handling
- **Added self-closing tag normalization**
- New `epub_translator/xml/self_closing.py` module handles 21 standard HTML5 void elements
- Improved compatibility with non-standard EPUB formats
- Related PR: https://github.com/oomol-lab/epub-translator/pull/96

### Mimetype File Ordering (#98)
- **Fixed mimetype file position in EPUB archives**
- Ensures mimetype appears as the first entry in ZIP files per EPUB OCF specification
- Preserved compression metadata during file migration
- Improved EPUB standard compliance
- Related PR: https://github.com/oomol-lab/epub-translator/pull/98

### Stream Processing Optimization (#101)
- **Refactored XMLStreamMapper for better element handling**
- Changed from batch processing to single-element processing
- Simplified internal logic while maintaining the same output behavior
- Reduced code complexity by 6 lines
- Related PR: https://github.com/oomol-lab/epub-translator/pull/101

## ‚ú® Features

### Enhanced Fill Template Algorithm (#99)
- **Improved fill.jinja template with better semantic matching**
- Shifted from position-based to semantic type matching
- Added formal "FILLING ALGORITHM" section with clear step-by-step instructions
- Introduced 4 numbered special-case rules for token counting, merged translations, and fallback strategies
- Improved handling of duplicate content (lines 116-120)
- Better error recovery with explicit fallback methods
- Related PR: https://github.com/oomol-lab/epub-translator/pull/99

### Cache Seed Content Support (#100)
- **Added cache_seed_content parameter for smarter cache invalidation**
- Runtime version and target language now included in cache keys
- Optimized LLMContext with set-based temporary file tracking
- Deterministic commit ordering through sorting
- Improved cache reliability across different runs
- Automatic cache invalidation on version updates
- Related PR: https://github.com/oomol-lab/epub-translator/pull/100

### Fragment Merging Refactor (#102)
- **Restructured stream processing logic**
- Replaced element-by-element grouping with serial group processing
- New `_split_into_serial_groups` and `_truncate_and_transform_group` methods
- Improved internal maintainability while preserving public API
- Better handling of nested content in resource segments
- Related PR: https://github.com/oomol-lab/epub-translator/pull/102

## üì¶ Installation

```bash
pip install epub-translator==0.1.3
```

Or upgrade from a previous version:

```bash
pip install --upgrade epub-translator
```

## Migration from v0.1.2

This release is fully backward compatible with v0.1.2. No code changes are required for migration. The new `cache_seed_content` parameter is optional and only needed if you want explicit control over cache invalidation.

## üôè Acknowledgments

Thanks to all contributors who helped improve EPUB compatibility and translation quality in this release!
